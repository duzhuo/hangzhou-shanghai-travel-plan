---
name: 为西湖历史文化添加语音播报功能
overview: 在西湖历史文化折叠模块中添加语音播报功能，允许用户通过点击按钮朗读当前展开的历史文化内容。
design:
  architecture:
    framework: react
    component: shadcn
  styleKeywords:
    - Chinese Style
    - Elegant
    - Minimalist
    - Fluid Animation
  fontSystem:
    fontFamily: Noto Sans SC
    heading:
      size: 24px
      weight: 600
    subheading:
      size: 16px
      weight: 500
    body:
      size: 14px
      weight: 400
  colorSystem:
    primary:
      - "#1E88E5"
      - "#42A5F5"
    background:
      - "#F5F7FA"
      - "#FFFFFF"
    text:
      - "#2C3E50"
      - "#546E7A"
    functional:
      - "#4CAF50"
      - "#F44336"
      - "#FF9800"
todos:
  - id: explore-codebase
    content: 使用 [subagent:code-explorer] 探索项目结构，定位历史文化模块文件
    status: completed
  - id: create-speech-service
    content: 创建 SpeechService 工具类，封装语音合成逻辑
    status: completed
    dependencies:
      - explore-codebase
  - id: develop-audio-player
    content: 开发 AudioPlayer 播放控制组件
    status: completed
    dependencies:
      - create-speech-service
  - id: integrate-to-section
    content: 将播放功能集成到 HistorySection 折叠模块中
    status: completed
    dependencies:
      - develop-audio-player
  - id: add-state-management
    content: 添加播放状态管理和切换模块自动停止逻辑
    status: completed
    dependencies:
      - integrate-to-section
  - id: style-polish
    content: 完善播放按钮样式和动画效果
    status: completed
    dependencies:
      - add-state-management
---

## Product Overview

为西湖历史文化折叠模块添加语音播报功能，提升用户阅读体验。

## Core Features

- 在每个历史文化折叠模块中添加语音播报按钮
- 点击按钮朗读当前展开的历史文化内容
- 再次点击或切换模块时停止播放
- 播放状态视觉反馈（播放中/停止状态）
- 支持暂停和继续播放功能

## Tech Stack

- 前端框架：React + TypeScript
- 语音合成：浏览器原生 Web Speech API (SpeechSynthesis)
- 状态管理：React Hooks (useState, useEffect, useRef)
- 样式：Tailwind CSS

## Tech Architecture

### System Architecture

- 架构模式：组件化架构
- 组件结构：HistorySection（历史章节组件）→ AudioPlayer（音频播放控制组件）
- 模块依赖：音频播放模块依赖于当前展开的历史内容状态

### Module Division

- **AudioPlayer Module**：封装语音合成逻辑，控制播放、暂停、停止功能
- **SpeechService**：语音服务类，管理浏览器 SpeechSynthesis 接口
- **UI Components Module**：播放按钮、进度指示器等交互组件

### Data Flow

用户点击播放按钮 → 读取当前展开的文本内容 → 调用 SpeechSynthesis API → 播放音频 → 更新播放状态 → UI 实时反馈

## Implementation Details

### Key Code Structures

**SpeechService Class**：封装浏览器语音合成接口，提供统一的播放控制方法。

```typescript
class SpeechService {
  private synth: SpeechSynthesis;
  private utterance: SpeechSynthesisUtterance | null = null;

  speak(text: string): void {
    this.cancel();
    this.utterance = new SpeechSynthesisUtterance(text);
    this.utterance.lang = 'zh-CN';
    this.synth.speak(this.utterance);
  }

  pause(): void {
    this.synth.pause();
  }

  resume(): void {
    this.synth.resume();
  }

  cancel(): void {
    this.synth.cancel();
  }
}
```

**AudioPlayer Component Props**：定义音频播放器组件的属性接口。

```typescript
interface AudioPlayerProps {
  content: string;          // 待朗读的文本内容
  isPlaying: boolean;       // 播放状态
  onPlay: () => void;       // 播放回调
  onPause: () => void;      // 暂停回调
  onStop: () => void;       // 停止回调
}
```

### Technical Implementation Plan

1. **问题陈述**：为折叠的历史文化模块添加语音播报功能
2. **解决方案**：使用浏览器原生 Web Speech API，避免引入额外依赖
3. **关键技术**：SpeechSynthesis API、React useRef 管理 speech 实例
4. **实施步骤**：

- 创建 SpeechService 工具类封装语音功能
- 开发 AudioPlayer 控制组件（播放/暂停/停止按钮）
- 集成到 HistorySection 组件中，绑定文本内容
- 添加播放状态管理和切换模块时自动停止逻辑

5. **测试策略**：测试不同文本长度、切换章节、暂停恢复等场景

### Integration Points

- 组件集成：AudioPlayer 嵌入到每个 HistorySection 折叠面板底部
- 状态同步：播放状态与折叠面板展开状态联动
- API 依赖：仅使用浏览器原生 SpeechSynthesis API

## Technical Considerations

- **兼容性**：检测浏览器 SpeechSynthesis 支持情况，提供降级提示
- **性能优化**：使用 useRef 存储 speech 实例，避免重复创建
- **错误处理**：处理语音合成异常（如网络语音包加载失败）
- **用户体验**：播放时高亮当前段落，提供播放进度反馈

## Design Style

采用简洁优雅的中国风设计，融入西湖文化元素。使用 React + TypeScript + Tailwind CSS + shadcn/ui 构建。播放按钮设计为圆形图标按钮，播放状态时显示动态声波动画效果。

## Page Planning

核心页面为西湖历史文化主页面，包含5个可折叠的历史文化模块。每个模块展开后在底部显示语音播报控制区。

### 单页块设计

**历史文化折叠模块块**：包含标题栏（可点击展开/收起）、内容展示区、语音播报控制栏

- 标题栏：右侧折叠箭头图标，展开时向下旋转
- 内容区：优雅的衬线字体排版，段落间距舒适
- 播放栏：居底浮动卡片，包含播放/暂停按钮、停止按钮、进度指示器

## Agent Extensions

### SubAgent

- **code-explorer**
- Purpose：探索现有项目结构，定位历史文化模块的具体文件位置
- Expected outcome：找到 HistorySection 相关组件文件，了解当前实现细节

### MCP

无相关 MCP 需要使用